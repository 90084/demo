<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Bible Soap Opera Demo</title>
        <meta name="description" content="An Interactive Audio Soap Opera">
        <meta name="author" content="Tim Roediger">
        <meta name="keywords" content="blah">
        
        <link rel="icon shortcut" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACNwAAAjcB9wZEwgAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAHgSURBVDiNjZE9aNNRFMV/55+kDYGgLu2gYqMOHRQKFQeLJa0aaTXWD+xkEVw62OIsiJsiQrcKougqthQ0FCExUAVxqw6OamIHP6BDQm2btE3edbDBpInGAw/effedc+89V2ZGNdL7hrdhxTFD58B2GZjQG4MHsWwizRaCquPU/tPdct4MsIcGMCzdYsvxaHauWHnzKpdE51C4ivzBHIP5ULCVknZKdgVYFTq+QXhm/tBooE4guM7EJnnqbba7S6J9+0rxCQEmnXmfneMo4itiMJf7dqlOQNgZ4HvAfKNH9r67h7hv0jJmbcJe+8Ruc9wFMPOu1gmYETVHz+KXwE+wXkkXYpnnl/OhYL/EMxM3nJTc/H3wjzFmdWcuGvVXx8mOeGcqEk8YKBWJF1KRuE1x0WdmtVtohpeRU13I9x5YPJFJtNWM0AzTB4Zb8Hy3f/vFdJ0H/8Krvj7/jkLxKcYAsKSym/h/AUkbC+HHZpwF1kAjxxZmM5W0vxk/1REfF4wAS+a5/tin2fnqfNMOJM4DmLi+lVzXQaJzKBxcZ1JyuZJXvhVw/l6gB1gte6VHjQrUCATzRadQ60lM7f6y/1plwSbdHPj4Yq2RQM0IsR/JFYnDhh4CBSArNB7LJO78bcRfFdHQ8rIfuRUAAAAASUVORK5CYII=" />
        
        <style>
          .sprite {
  background-image: url("data:image/png;base64,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");
}
.btn {
  border: 0 none;
  border-radius: 2px 2px 2px 2px;
  cursor: pointer;
  background-size: 30px 30px;
  width: 30px;
  height: 30px;
  display: inline-block;
}
html,
body {
  height: 100%;
  width: 100%;
  margin: 0;
  text-align: center;
  overflow: hidden;
  font-size: 20px;
  font-family: Sans-Serif;
}
.hidden,
.hidden {
  display: none;
}
a {
  color: #ffffff;
  text-decoration: none;
  font-style: italic;
}
a:hover {
  text-decoration: underline;
}
.top-nav {
  position: absolute;
  z-index: 10;
  width: 100%;
  height: 100%;
  min-height: 100%;
  margin-top: 14px;
  top: -100%;
  left: 0px;
  transition-property: margin-top top;
  transition-duration: .5s;
  background-color: #2e0a3a;
  display: table;
  text-align: center;
}
.top-nav .inner {
  display: table-cell;
  vertical-align: middle;
  height: 100%;
  min-height: 100%;
}
.top-nav .container {
  width: 100%;
  margin-left: auto;
  margin-right: auto;
}
.top-nav .container-inner {
  margin-left: auto;
  margin-right: auto;
  display: inline-block;
  padding: 15px;
  color: white;
  font-size: 15px;
  font-family: sans-serif;
}
.top-nav .toggle {
  position: absolute;
  bottom: 0px;
  left: 0;
  height: 14px;
  width: 100%;
  line-height: 8px;
  font-size: 0;
}
.top-nav .toggle .chevron {
  transform: rotate(180deg);
  width: 14px;
  height: 14px;
  margin-left: auto;
  margin-right: 10px;
  background-size: 112px 14px;
  background-position: 14px 0;
  opacity: 0.5;
}
.top-nav .toggle:hover {
  background-color: rgba(255, 255, 255, 0.2);
}
.top-nav .toggle:hover .chevron {
  opacity: 1;
}
.top-nav .thumbs {
  position: absolute;
  bottom: 0px;
  left: 0;
  height: 14px;
  font-size: 0;
}
.top-nav .thumbs div {
  width: 12px;
  height: 14px;
  display: inline-block;
  opacity: 0.3;
  transition-property: opacity;
  transition-duration: .5s;
}
.top-nav .thumbs div.complete {
  opacity: 0.7;
}
.top-nav .thumbs div.active {
  opacity: 1;
}
.top-nav .info {
  background-color: #338bf7;
}
.top-nav .discuss {
  background-color: #d7591f;
}
.top-nav .listen {
  background-color: #ba214d;
}
.top-nav .nav-table {
  display: table;
}
.top-nav .summary {
  display: table-cell;
  vertical-align: middle;
  height: 100%;
  background-color: #2ca700;
  width: 140px;
  border-radius: 2px 2px 2px 2px;
}
.top-nav .summary-table {
  display: table;
  margin-left: auto;
  margin-right: auto;
}
.top-nav .summary-table .summary-cell {
  display: table-cell;
}
.top-nav .summary-table .summary-cell .title {
  font-weight: 900;
  padding: 10px;
}
.top-nav .summary-table .summary-cell .sub-title {
  font-size: 12px;
  padding: 0 10px;
}
.top-nav .sections {
  display: table-cell;
}
.top-nav .sections-table {
  display: table;
  width: 240px;
}
.top-nav .sections-table > div {
  display: table-row;
}
.top-nav .sections-table > div div {
  height: 25px;
  border-radius: 2px 2px 2px 2px;
  text-align: left;
  margin-left: 5px;
  margin-bottom: 5px;
}
.top-nav .sections-table > div:last-child div {
  margin-bottom: 0;
}
.top-nav .sections-table .sprite {
  width: 15px;
  height: 15px;
  display: inline-block;
  vertical-align: middle;
  margin-top: 5px;
  margin-bottom: 5px;
  margin-left: 5px;
  margin-right: 10px;
  background-size: 240px 30px;
}
.top-nav .sections-table .info .sprite {
  background-position: 60px 0;
}
.top-nav .sections-table .discuss .sprite {
  background-position: 45px 0;
}
.top-nav .sections-table .listen .sprite {
  background-position: 60px 15px;
}
.top-nav.active {
  margin-top: 0;
  top: 0;
}
.top-nav.active .toggle .chevron {
  transform: rotate(0deg);
}
.btn.previous,
.btn.next {
  background-size: 240px 30px;
  background-position: 240px 0;
  position: fixed;
  z-index: 1;
  bottom: 10px;
}
.btn.previous:hover,
.btn.next:hover {
  background-color: rgba(255, 255, 255, 0.2);
}
.btn.previous.disabled,
.btn.next.disabled {
  opacity: 0.5;
  cursor: inherit;
}
.btn.previous.disabled:hover,
.btn.next.disabled:hover {
  background-color: rgba(255, 255, 255, 0);
}
.btn.previous {
  left: 10px;
  transform: rotate(180deg);
}
.btn.next {
  right: 10px;
}
.slide {
  display: none;
  position: absolute;
  width: 100%;
  height: 100%;
  min-height: 100%;
  transition-property: left, top;
  transition-duration: 1s, 1s;
}
.slide.left,
.slide.right,
.slide.up,
.slide.down,
.slide.active {
  display: table;
}
.slide.left {
  left: -100%;
}
.slide.right {
  left: 100%;
}
.slide.up {
  top: -100%;
}
.slide.down {
  top: 100%;
}
.slide.active {
  left: 0px;
  top: 0px;
}
.slide-inner {
  display: table-cell;
  vertical-align: middle;
  height: 100%;
  min-height: 100%;
}
.slide-container {
  width: 100%;
}
.slide-container-inner {
  margin-left: auto;
  margin-right: auto;
  display: inline-block;
  padding: 15px;
}
.spinner {
  width: 70px;
  text-align: center;
}
.spinner > div {
  width: 18px;
  height: 18px;
  background-color: #ffffff;
  border-radius: 100%;
  display: inline-block;
  -webkit-animation: bouncedelay 1.4s infinite ease-in-out;
  animation: bouncedelay 1.4s infinite ease-in-out;
  /* Prevent first frame from flickering when animation starts */
  -webkit-animation-fill-mode: both;
  animation-fill-mode: both;
}
.spinner .bounce1 {
  -webkit-animation-delay: -0.32s;
  animation-delay: -0.32s;
}
.spinner .bounce2 {
  -webkit-animation-delay: -0.16s;
  animation-delay: -0.16s;
}
@-webkit-keyframes bouncedelay {
  0%,
  80%,
  100% {
    -webkit-transform: scale(0);
  }
  40% {
    -webkit-transform: scale(1);
  }
}
@keyframes bouncedelay {
  0%,
  80%,
  100% {
    transform: scale(0);
    -webkit-transform: scale(0);
  }
  40% {
    transform: scale(1);
    -webkit-transform: scale(1);
  }
}
.icon.next {
  background-size: 15px 15px;
  width: 15px;
  height: 15px;
  display: inline-block;
  background-size: 120px 15px;
  background-position: 120px 0;
}
.slide .discuss {
  background-color: #d7591f;
  color: #ffffff;
}
.slide .info {
  background-color: #338bf7;
  color: #ffffff;
}
.slide .listen {
  background-color: #ba214d;
  color: #ffffff;
}
.slide .pick ul {
  padding: 0;
}
.slide .pick li {
  list-style-type: none;
  padding: 10px 0;
  margin: 10px 0;
  cursor: pointer;
  border-radius: 2px 2px 2px 2px;
  background-color: rgba(255, 255, 255, 0.1);
}
.slide .pick li:hover {
  background-color: rgba(255, 255, 255, 0.2);
}
.slide .pick li.active {
  background-color: rgba(255, 255, 255, 0.4);
}
.slide .pick li.active:hover {
  background-color: rgba(255, 255, 255, 0.4);
}
.slide .pick .answers {
  width: 300px;
  margin-left: auto;
  margin-right: auto;
}
.slide .slider .track-container {
  position: relative;
  width: 300px;
  height: 100px;
  padding-top: 10px;
  margin-left: auto;
  margin-right: auto;
}
.slide .slider .track {
  width: 300px;
  height: 10px;
  background-color: rgba(255, 255, 255, 0.2);
  border-radius: 5px 5px 5px 5px;
}
.slide .slider .grip {
  width: 30px;
  height: 30px;
  background-color: rgba(255, 255, 255, 0.8);
  border-radius: 15px 15px 15px 15px;
  cursor: pointer;
  position: absolute;
  top: 0px;
  left: 135px;
}
.slide .slider .grip:hover,
.slide .slider .grip.active {
  background-color: #ffffff;
}
.slide .slider .left,
.slide .slider .right {
  position: absolute;
}
.slide .slider .left {
  top: 30px;
  left: -75px;
  width: 150px;
}
.slide .slider .right {
  top: 30px;
  left: 225px;
  width: 150px;
}
.slide .sort .answer-container {
  display: table;
  border-spacing: 10px;
}
.slide .sort .answer-container .row {
  display: table-row;
}
.slide .sort .answer-container .row .numbers,
.slide .sort .answer-container .row .answers {
  display: table-cell;
}
.slide .sort .answer-container .row .number,
.slide .sort .answer-container .row .answer {
  height: 40px;
  line-height: 40px;
  margin: 10px 0;
  border-radius: 2px 2px 2px 2px;
}
.slide .sort .answer-container .row .number {
  width: 40px;
}
.slide .sort .answer-container .row .answer {
  background-color: rgba(255, 255, 255, 0.1);
  width: 250px;
  cursor: pointer;
}
.slide .sort .answer-container .row .answer:hover {
  background-color: rgba(255, 255, 255, 0.2);
}
.slide .sort .answer-container .row .drag {
  margin: 0;
  position: fixed;
  left: 0;
  top: 0;
  background-color: rgba(255, 255, 255, 0.4);
}
.slide .audio .track-container {
  position: relative;
  height: 100px;
  width: 300px;
  padding-top: 2.5px;
  margin-left: auto;
  margin-right: auto;
}
.slide .audio .track {
  width: 300px;
  height: 5px;
  background-color: rgba(255, 255, 255, 0.2);
  border-radius: 2.5px 2.5px 2.5px 2.5px;
}
.slide .audio .track .progress {
  width: 0;
  height: 5px;
  background-color: rgba(255, 255, 255, 0.5);
  border-radius: 2.5px 2.5px 2.5px 2.5px;
}
.slide .audio .track .progress:hover {
  cursor: pointer;
}
.slide .audio .grip {
  width: 10px;
  height: 10px;
  background-color: rgba(255, 255, 255, 0.8);
  border-radius: 5px 5px 5px 5px;
  position: absolute;
  top: 0px;
  left: -2.5px;
}
.slide .audio .grip:hover {
  background-color: #ffffff;
  cursor: pointer;
}
.slide .audio .left,
.slide .audio .right {
  position: absolute;
}
.slide .audio .left {
  top: 15px;
  left: 0px;
}
.slide .audio .right {
  top: 15px;
  right: 0px;
}
.slide .audio .btn:hover {
  background-color: rgba(255, 255, 255, 0.2);
}
.slide .audio .play {
  background-size: 240px 30px;
  background-position: 210px 0;
}
.slide .audio .pause {
  background-size: 240px 30px;
  background-position: 180px 0;
}
.slide .audio .rewind {
  background-size: 240px 30px;
  background-position: 150px 0;
}
.slide .audio .vol-plus,
.slide .audio .vol-minus {
  opacity: 0.8;
}
.slide .audio .vol-plus {
  background-size: 240px 30px;
  background-position: 120px 0;
}
.slide .audio .vol-minus {
  background-size: 240px 30px;
  background-position: 90px 0;
}
.slide .audio .vol-track {
  background-color: rgba(255, 255, 255, 0.2);
  height: 30px;
  width: 5px;
  border-radius: 2.5px 2.5px 2.5px 2.5px;
  display: inline-block;
}
.slide .audio .vol-grip {
  background-color: rgba(255, 255, 255, 0.6);
  height: 15px;
  width: 5px;
  top: 15px;
  position: relative;
  border-radius: 2.5px 2.5px 2.5px 2.5px;
}
  
        </style>         
    </head>
    <body>

        <div class='top-nav'>
    <div class='inner'>
        <div class='container'>
            <div class='container-inner'>
                <div class='nav-table'>
                    <div class='summary'>
                        <div class='summary-table'>
                            <div class='summary-cell'>
                                <div class='title'></div>
                                <div class='sub-title'></div>
                            </div>
                        </div>
                    </div>
                    <div class='sections'>
                        <div class='sections-table'>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class='thumbs'></div>    
    <div class='toggle'>
        <div class='sprite chevron'></div>
    </div>
</div>
        

        <div class='slide active loading'>
    <div class='slide-inner info'>
        <div class='slide-container'>
            <div class='slide-container-inner'>
                <div class="spinner hidden">
  <div class="bounce1"></div>
  <div class="bounce2"></div>
  <div class="bounce3"></div>
</div>
         
            </div>
        </div>
    </div>
</div>
         
    
        <template data-slide='audio'>
    <div class='slide'>
        <div class='slide-inner'>
            <div class='slide-container'>
                <div class='slide-container-inner audio'>

                    <div class="spinner hidden">
  <div class="bounce1"></div>
  <div class="bounce2"></div>
  <div class="bounce3"></div>
</div>
 

                    <div class='player-container hidden'>
                        <p class='text'></p>
                        <div class="track-container">
                            <div class="track">
                                <div class='progress'></div>                                  
                            </div>
                            <div class="grip"></div>                       
                            <div class="left">
                                <a class='btn sprite action play'></a>
                            </div>
                            <div class="right">
                                <a class='btn sprite vol-minus'></a>
                                <div class='vol-track'>
                                    <div class='vol-grip'></div>
                                </div>                             
                                <a class='btn sprite vol-plus'></a>                                                   
                            </div>                         
                        </div>              
                    </div>
                </div>
            </div>
        </div>
    </div>        
</template>


        <template data-slide='html'>
    <div class='slide'>
        <div class='slide-inner'>
            <div class='slide-container'>
                <div class='slide-container-inner html'>
                    <p class='content'></p>
                </div>
            </div>
        </div>
    </div>        
</template>

        <template data-slide='pick'>
    <div class='slide'>
        <div class='slide-inner'>
            <div class='slide-container'>
                <div class='slide-container-inner pick'>
                    <p class='question'></p>
                    <ul class='answers'></ul>
                </div>
            </div>
        </div>
    </div>        
</template>

        <template data-slide='slider'>
    <div class='slide'>
        <div class='slide-inner'>
            <div class='slide-container'>
                <div class='slide-container-inner slider'>
                    <p class='question'></p>
                    <div class="track-container">
                        <div class="track"></div>
                        <div class="grip"></div>
                        <div class="left"></div>
                        <div class="right"></div>                        
                    </div>                    
                </div>
            </div>
        </div>
    </div>        
</template>

        <template data-slide='sort'>
    <div class='slide'>
        <div class='slide-inner'>
            <div class='slide-container'>
                <div class='slide-container-inner sort'>
                    <p class='question'></p>
                    <div class='answer-container'>
                        <div class="row">
                            <div class="numbers"></div>
                            <div class="answers">
                                <div class="answer hidden drag"></div>
                            </div>
                        </div>
                    </div>                    
                </div>
            </div>
        </div>
    </div>        
</template>

        <template data-slide='title'>
    <div class='slide'>
        <div class='slide-inner'>
            <div class='slide-container'>
                <div class='slide-container-inner title'>
                    <h1></h1>
                    <p class='subtitle'></p>
                </div>
            </div>
        </div>
    </div>        
</template>
        
         
        <script>
            var bso = {slide: {}};
            bso.decodeUtf8 = function(data) {
  var result = "";
  var i = 0;
  var c = 0;
  var c1 = 0;
  var c2 = 0;

  // If we have a BOM skip it
  if (data.byteLength >= 3 && data.getUint8(0) === 0xef && data.getUint8(1) === 0xbb && data.getUint8(2) === 0xbf) {
    i = 3;
  }

  while (i < data.byteLength) {
    c = data.getUint8(i);

    if (c < 128) {
      result += String.fromCharCode(c);
      i++;
    } else if (c > 191 && c < 224) {
      if( i+1 >= data.byteLength ) {
        throw "UTF-8 Decode failed. Two byte character was truncated.";
      }
      c2 = data.getUint8(i+1);
      result += String.fromCharCode( ((c&31)<<6) | (c2&63) );
      i += 2;
    } else {
      if (i+2 >= data.byteLength) {
        throw "UTF-8 Decode failed. Multi byte character was truncated.";
      }
      c2 = data.getUint8(i+1);
      c3 = data.getUint8(i+2);
      result += String.fromCharCode( ((c&15)<<12) | ((c2&63)<<6) | (c3&63) );
      i += 3;
    }
  }
  return result;
}

bso.evented = function(context){         
    var registry = {};
 
    context.on = function(eventName, handler){
        if (!registry[eventName]) registry[eventName] = [];
        registry[eventName].push(handler);
    };
    
    context.emit = function(eventName, eventObj){
        if (registry[eventName]) {
            registry[eventName].forEach(function(handler){
                handler(eventObj)
            })
        }
    }
}

bso.getClientX = function(evt){
    if (evt.touches) return evt.touches[0].clientX;
    else return evt.clientX;        
}

bso.getClientY = function(evt){
    if (evt.touches) return evt.touches[0].clientY;
    else return evt.clientY;        
}

bso.loadEpisode = function(name){

  document.querySelector('.spinner').setAttribute('class', 'spinner');
  
  var episodeData;
  var partialAudio;
  
  function loadEpisodeData(cb){
    var xhr = new XMLHttpRequest();
    xhr.open('GET', name + '.bso', true);
    xhr.setRequestHeader('Range', 'bytes=0-20000');  
    xhr.responseType = "arraybuffer";

    xhr.onreadystatechange = function() {

      if (this.readyState == 4 && this.status == 206) {

        var jsonLength = parseInt(bso.decodeUtf8(new DataView(this.response, 0, 16)).trim());
        episodeData = JSON.parse(bso.decodeUtf8(new DataView(this.response, 16, jsonLength)));
        partialAudio = new DataView(this.response, 16 + length);
        
        cb();
      }
    };

    xhr.send();      
  }
  
  function loadAudio(){
    var xhr = new XMLHttpRequest();
    xhr.open('GET', name + '.bso', true);
    xhr.setRequestHeader('Range', 'bytes=20001-');  
    xhr.responseType = "arraybuffer";

    xhr.onreadystatechange = function() {

      if (this.readyState == 4 && this.status == 206) {        
        bso.player().src = URL.createObjectURL(new Blob([partialAudio, this.response], {type: 'audio/mpeg'}));
      }
    };

    xhr.send();      
  }
  
  loadEpisodeData(function(){             
      bso.runEpisode(episodeData);
      loadAudio();
  })   
}

bso.nav = function(name, dir){
    return {
        create: function(goFn){
           var btn = document.createElement('a');
           btn.setAttribute('class', 'btn sprite ' + name);
           btn.addEventListener('click', function(){
               goFn(dir);
           });
           document.body.appendChild(btn);
           this.disabled = false;
           this.hidden = false;
        },
        render: function(){
           var cls = 'btn sprite ' + name;
           if (this.disabled) cls += ' disabled'
           if (this.hidden) cls += ' hidden'
           document.querySelector('.btn.' + name).setAttribute('class', cls);        
        },
        show: function(){
           this.hidden = false;
           this.render();
        },
        hide: function(){    
           this.hidden = true;
           this.render();       
        },
        enable: function(){        
           this.disabled = false;
           this.render();       
        },
        disable: function(){
           this.disabled = true;
           this.render();        
        }
    }
}

bso.next = bso.nav('next', 1);

bso.previous = bso.nav('previous', -1);
bso.player = function(){
   
    if (!bso.player._instance){
        var player = new Audio();     
        player.ready = new bso.promise;
        
        var canplay = function(){
            player.removeEventListener('canplay', canplay);            
            player.ready.resolve();            
        };
        player.addEventListener('canplay', canplay);
        
        bso.player._instance = player;
    }
    return bso.player._instance;
}



bso.promise = function(){
    this.resolve = function(result){
      this._resolved = true;
      this._result = result;
      if (this._callbacks){
          for(var i=0; i < this._callbacks.length; i++){
              this._callbacks[i](result);
          }
      }
    }.bind(this);
    this.then = function(cb){
        if (this._resolved) cb(this._result);
        if (!this._callbacks) this._callbacks = [];
        this._callbacks.push(cb);
    }.bind(this);
}



bso.runEpisode = function(episodeData){
  
  var sectionIndex = 0;
  var slideIndex = -1;

  var transitioner = new bso.slideTransitioner();
  
  //setup top-nav     
  bso.topNav(episodeData);
  var thumbs = document.querySelector('.top-nav .thumbs');
   
  var slideCache = [];
  function go(dir){
  
    if (dir === 1 && bso.next.disabled) return
    if (dir === -1 && bso.previous.disabled) return

    //deactivate exiting slide thumb
    if (slideCache.length > 0){
        thumbs.querySelector('[data-slide-index=i' + sectionIndex + '-' + slideIndex + ']').setAttribute(
            'class', 
            episodeData.sections[sectionIndex].type + (slideCache[sectionIndex][slideIndex].complete ? ' complete' : '')
        );
    }
    
    slideIndex += dir;
    if(slideIndex === -1 || slideIndex === episodeData.sections[sectionIndex].slides.length){
        sectionIndex += dir;              
        if (slideIndex === -1) slideIndex = episodeData.sections[sectionIndex].slides.length - 1
        else slideIndex = 0    
    }        

    if(slideIndex === episodeData.sections[sectionIndex].slides.length-1 && sectionIndex === episodeData.sections.length-1){
       bso.next.hide();
    } else {
       bso.next.show();
    }
    
    if(slideIndex === 0 && sectionIndex === 0){
        bso.previous.hide();
    } else {
        bso.previous.show();
    }
  
    if (!slideCache[sectionIndex]) slideCache[sectionIndex] = []
    if (!slideCache[sectionIndex][slideIndex]){
        var type = episodeData.sections[sectionIndex].slides[slideIndex].type;
        var config = episodeData.sections[sectionIndex].slides[slideIndex];
        if (type === 'title') {
            config.title = episodeData.title;
            config.subtitle = episodeData.subtitle;
        }
    
        var newSlide = new bso.slide[type](config, episodeData.sections[sectionIndex].type);
        slideCache[sectionIndex][slideIndex] = newSlide;
        if (newSlide.on) newSlide.on('complete', function(){bso.next.enable()})
    }

    //activate entering slide thumb        
    thumbs.querySelector('[data-slide-index=i' + sectionIndex + '-' + slideIndex + ']').setAttribute(
        'class', 
        episodeData.sections[sectionIndex].type + ' active' + (slideCache[sectionIndex][slideIndex].complete ? ' complete' : '')
    ); 
          
    transitioner.transition(slideCache[sectionIndex][slideIndex], dir === 1 ? 'right' : 'left');     
  }  
  
  bso.previous.create(go);  
  bso.next.create(go);
   
  go(1);  
  
  var loadingSlide = document.querySelector('.slide.loading'); 
  loadingSlide.parentNode.removeChild(loadingSlide);
};

bso.slideTransitioner = function () {

    var activeSlide;

    var slideTransitionEnd = function(evt){
        evt.target.removeEventListener('transitionend', slideTransitionEnd);
        evt.target.setAttribute('class', 'slide');
    }.bind(this);

    this.transition = function (newSlide, direction) {

        if (!activeSlide) {
            newSlide.node.setAttribute('class', 'slide active');
            if (newSlide.complete)
                bso.next.enable()
            else
                bso.next.disable()            
            newSlide.enter();
            activeSlide = newSlide;
            return;
        }

        var activeNode = activeSlide.node;
        var newNode = newSlide.node;

        activeNode.addEventListener('transitionend', slideTransitionEnd);

        //position slide ready for transiton
        newNode.setAttribute('class', 'slide ' + direction);

        if (activeSlide.exit)
            activeSlide.exit()
        if (newSlide.enter)
            newSlide.enter()

        if (newSlide.complete)
            bso.next.enable()
        else
            bso.next.disable()

        //wait for repaint
        setTimeout(function () {
            //now apply the transitions
            var outDirection = direction === 'left' ? 'right' : direction === 'right' ? 'left' : direction === 'up' ? 'down' : 'up';

            activeNode.setAttribute('class', 'slide ' + outDirection);
            newNode.setAttribute('class', 'slide active');
            activeSlide = newSlide;
        }, 80);
    }
}

bso.start = function(){
  bso.loadEpisode('ep1');
}

bso.topNav = function(episodeData){
  
  var topNav = document.querySelector('.top-nav');
  
  topNav.querySelector('.title').innerHTML = episodeData.title;
  topNav.querySelector('.sub-title').innerHTML = episodeData.subtitle;  
  
  var sectionsTable = topNav.querySelector('.sections-table');
  var thumbs = topNav.querySelector('.thumbs');
  var sectionDiv;
  var slideDiv;
  for (var i in episodeData.sections){
    sectionDiv = document.createElement('div');

    sectionDiv.innerHTML = "<div class='" +  episodeData.sections[i].type + "'><span class='sprite'></span>" + episodeData.sections[i].title + "</div>";     
    sectionsTable.appendChild(sectionDiv);    
  
    for (var j in episodeData.sections[i].slides){
        slideDiv = document.createElement('div');
        slideDiv.setAttribute('class', episodeData.sections[i].type);        
        slideDiv.setAttribute('data-slide-index', 'i' + i + '-' + j);
        
        thumbs.appendChild(slideDiv);
    }
  }
  
  topNav.querySelector('.toggle').addEventListener('click', function(){
    if (topNav.getAttribute('class').indexOf('active') === -1){
        topNav.setAttribute('class', 'top-nav active');
    } else {
        topNav.setAttribute('class', 'top-nav');        
    }
  });
}

bso.slide.audio = function(config, sectionType){

    var template = document.querySelector('[data-slide=audio]');      
    var clone = document.importNode(template.content, true);
    var progressTime = config.start;
    var hasFocus;
    var ready;
    var player = bso.player();
    var playerContainer = clone.querySelector('.player-container');    
    var spinner = clone.querySelector('.spinner');    
    spinner.setAttribute('class', 'spinner');     
      
    player.ready.then(function(){
        spinner.setAttribute('class', 'spinner hidden');      
        playerContainer.setAttribute('class', 'player-container');          
console.log(player.seekable.start(0));
console.log(player.seekable.end(0));        
        player.currentTime = config.start;
        ready = true;       
        if (hasFocus) play();        
    });
    
    clone.querySelector('.text').innerHTML = config.text;    
    clone.querySelector('.slide-inner').setAttribute('class', 'slide-inner ' + sectionType);      
       
    var actionBtn = clone.querySelector('.action');
    actionBtn.addEventListener('click', action);
    
    function play(){          
        if (!ready) return; 
        player.play();
        actionBtn.setAttribute('class', 'btn sprite action pause');         
    }
    
    function pause(){       
        if (!ready) return; 
        player.pause();
        actionBtn.setAttribute('class', 'btn sprite action play');        
    }
    
    function rewind(){     
        if (!ready) return;
        player.currentTime = config.start;
        actionBtn.setAttribute('class', 'btn sprite action play');          
    }
      
    function action(){
        var cls = actionBtn.getAttribute('class');
        if (cls.indexOf('play') !== -1) play()
        else if (cls.indexOf('pause') !== -1) pause()
        else if (cls.indexOf('rewind') !== -1) rewind()
    }
       
    var volumeGrip = clone.querySelector('.vol-grip');
    function setVolumeGrip(){        
        volumeGrip.style.height = Math.round(30 * player.volume) + 'px';
        volumeGrip.style.top = Math.round(30 * (1 - player.volume)) + 'px';
    }
       
    clone.querySelector('.vol-plus').addEventListener('click', function(){
        if (player.volume > 0.9) player.volume = 1
        player.volume+=0.1;
        setVolumeGrip();
    });
    clone.querySelector('.vol-minus').addEventListener('click', function(){        
        if (player.volume < 0.1) player.volume = 0
        else player.volume-=0.1;
        setVolumeGrip();
    });
    setVolumeGrip();
              
    var grip = clone.querySelector('.grip');
    var progress = clone.querySelector('.progress');
    
    var timeupdate = function(){        
        if (player.currentTime >= config.end) {
            pause();
            actionBtn.setAttribute('class', 'btn sprite action rewind');           
            this.complete = true;
            this.emit('complete');
        }
        var position = Math.round(300*(player.currentTime - config.start)/(config.end - config.start));
        if (position < 0) position = 0
        else if (position > 300) position = 300
        
        grip.style.left = (position - 2.5) + 'px';
        
        if (progressTime < player.currentTime){
            progressTime = player.currentTime;
            progress.style.width = position + 'px';            
        }
    }.bind(this);
       
    var isPlaying;
    var gripDragPosition;
    var dragstart = function(evt){
        isPlaying = !player.paused;
        player.pause();
        gripDragPosition = {
            left: parseInt(grip.style.left.replace('px', '')),
            client: bso.getClientX(evt)
        }
        document.addEventListener('mouseup', dragend);
        document.addEventListener('mousemove', dragmove);    
        document.addEventListener('touchend', dragend);
        document.addEventListener('touchmove', dragmove);     
    };
    
    var dragend = function(){        
        document.removeEventListener('mousemove', dragmove);        
        document.removeEventListener('mouseup', dragend);
        document.removeEventListener('touchmove', dragmove);        
        document.removeEventListener('touchend', dragend);  
        var currentTime = config.start + (gripDragPosition.left + 2.5) * (config.end - config.start) / 300;
        if (currentTime < config.start) currentTime = config.start
        else if (currentTime > config.end) currentTime = config.end
    
        player.currentTime = currentTime;        
        if (isPlaying) player.play();
    };
    
    var dragmove = function(evt){
        var clientX = bso.getClientX(evt);        
        var newLeft = gripDragPosition.left + clientX - gripDragPosition.client;

        if (newLeft < -2.5){
            newLeft = -2.5;
        } else if (newLeft > progress.style.width.replace('px', '') - 2.5){
            newLeft = progress.style.width.replace('px', '') - 2.5;
        }
        
        grip.style.left = newLeft + 'px';        
        gripDragPosition.left = newLeft;
        gripDragPosition.client = clientX;
    }
      
    grip.addEventListener('mousedown', dragstart);
    grip.addEventListener('touchstart', dragstart);        
    
    progress.addEventListener('click', function(event){
        var currentTime = config.start + (event.clientX - progress.getBoundingClientRect().left) * (config.end - config.start) / 300;
        if (currentTime < config.start) currentTime = config.start
        else if (currentTime > config.end) currentTime = config.end
        player.currentTime = currentTime; 
    })
    
    document.body.appendChild(clone);
    this.node = document.body.lastElementChild;   
    
    this.enter = function(){       
        hasFocus = false;
        player.addEventListener('timeupdate', timeupdate);        
        setTimeout(function(){           
           hasFocus = true;
           if (actionBtn.getAttribute('class').indexOf('play') !== -1) play();
        }, 1400);        
    }
    
    this.exit = function(){
        player.removeEventListener('timeupdate', timeupdate);        
        if (actionBtn.getAttribute('class').indexOf('pause') !== -1) pause();
    }
    
    bso.evented(this);
}

bso.slide.html = function(config, sectionType){
        
    var template = document.querySelector('[data-slide=html]');    
    var clone = document.importNode(template.content, true);
    clone.querySelector('.slide-inner').setAttribute('class', 'slide-inner ' + sectionType);
    clone.querySelector('.content').innerHTML = config.content;

    document.body.appendChild(clone);
    this.node = document.body.lastElementChild;        
        
    this.complete = true;
}

bso.slide.pick = function(config, sectionType){
    
    var template = document.querySelector('[data-slide=pick]');    
    var clone = document.importNode(template.content, true);
    clone.querySelector('.slide-inner').setAttribute('class', 'slide-inner ' + sectionType);     
    clone.querySelector('.question').innerHTML = config.question;
    
    var answerList = clone.querySelector('.answers');

    for (var i=0; i<config.answers.length; i++){
       var answer = config.answers[i];
       var li = document.createElement('li');
       li.innerHTML = answer;
       li.addEventListener('click', function(event){
         for(var i=0; i<answerList.children.length; i++) answerList.children[i].removeAttribute('class')
         event.target.setAttribute('class', 'active'); 
         this.complete = true;
         this.emit('complete');  
       }.bind(this));
       answerList.appendChild(li);
    }
                    
    document.body.appendChild(clone);
    this.node = document.body.lastElementChild;
    
    bso.evented(this);
}

bso.slide.slider = function(config, sectionType){
               
    var template = document.querySelector('[data-slide=slider]');    
    var clone = document.importNode(template.content, true);
    clone.querySelector('.slide-inner').setAttribute('class', 'slide-inner ' + sectionType);     
    clone.querySelector('.question').innerHTML = config.question;
         
    var leftAnswer = clone.querySelector('.left');
    leftAnswer.innerHTML = config.left;

    var rightAnswer = clone.querySelector('.right');
    rightAnswer.innerHTML = config.right;
    
    var position;
    var grip = clone.querySelector('.grip');
    var track = clone.querySelector('.track');
    
    var dragstart = function(evt){          
        position = {
            left: parseInt(window.getComputedStyle(grip).getPropertyValue('left').replace('px', '')),
            client: bso.getClientX(evt)
        }
        document.addEventListener('mouseup', dragend);
        document.addEventListener('mousemove', dragmove);    
        document.addEventListener('touchend', dragend);
        document.addEventListener('touchmove', dragmove);        
        grip.setAttribute('class', 'grip active');
    };
        
    var dragend = function(){
        document.removeEventListener('mousemove', dragmove);        
        document.removeEventListener('mouseup', dragend);
        document.removeEventListener('touchmove', dragmove);        
        document.removeEventListener('touchend', dragend);        
        grip.setAttribute('class', 'grip'); 
        this.complete = true;
        this.emit('complete');
    }.bind(this);
    
    var dragmove = function(evt){
        var clientX = bso.getClientX(evt);      
        var newLeft = position.left + clientX - position.client;
        
        if (newLeft < -10){
            newLeft = -10;
        } else if (newLeft > 280){
            newLeft = 280;
        }
        
        grip.style.left = newLeft + 'px';        
        position.left = newLeft;
        position.client = clientX;
    }
    
    grip.addEventListener('mousedown', dragstart);
    grip.addEventListener('touchstart', dragstart);
    
    track.addEventListener('click', function(evt){        
        grip.style.left = evt.clientX - track.getBoundingClientRect().left - grip.getBoundingClientRect().width/2 + 'px';       
        this.complete = true;
        this.emit('complete');        
    }.bind(this))
    
    document.body.appendChild(clone);
    this.node = document.body.lastElementChild;
    
    bso.evented(this);    
}

bso.slide.sort = function(config, sectionType){
    
    var template = document.querySelector('[data-slide=sort]');    
    var clone = document.importNode(template.content, true);
    clone.querySelector('.slide-inner').setAttribute('class', 'slide-inner ' + sectionType);         
    clone.querySelector('.question').innerHTML = config.question;
    
    var drag = clone.querySelector('.drag');
    var numberList = clone.querySelector('.numbers');
    var answerList = clone.querySelector('.answers');
    
    var beingDragged;
    var position;    
    
    var dragstart = function(evt){
               
        beingDragged = evt.target;
        position = {
            left: beingDragged.offsetLeft,
            top: beingDragged.offsetTop,
            clientX: bso.getClientX(evt),
            clientY: bso.getClientY(evt)
        };
        drag.style.left = beingDragged.offsetLeft + 'px';        
        drag.style.top = beingDragged.offsetTop + 'px';
        
        document.addEventListener('mouseup', dragend);
        document.addEventListener('mousemove', dragmove);    
        document.addEventListener('touchend', dragend);
        document.addEventListener('touchmove', dragmove); 
        drag.setAttribute('class', 'answer drag');
        drag.innerHTML = beingDragged.innerHTML;
    };
    
    var dragend = function(){           
        document.removeEventListener('mousemove', dragmove);        
        document.removeEventListener('mouseup', dragend);
        document.removeEventListener('touchmove', dragmove);        
        document.removeEventListener('touchend', dragend);        
        drag.setAttribute('class', 'answer hidden drag'); 
        this.complete = true;
        this.emit('complete');
    }.bind(this);
    
    var dragmove = function(evt){
        
        var clientX = bso.getClientX(evt); 
        var clientY = bso.getClientY(evt);
        var newLeft = position.left + clientX - position.clientX;
        var newTop = position.top + clientY - position.clientY;
               
        drag.style.left = newLeft + 'px';        
        drag.style.top = newTop + 'px';
        position.left = newLeft;
        position.top = newTop;
        position.clientX = clientX;               
        position.clientY = clientY;
        
        var i, child, diff = 1000, targetChild;
        for (i=0; i<answerList.children.length; i++){
            child = answerList.children[i];
            if (child===drag) continue; 
            if (Math.abs(drag.offsetTop - child.offsetTop) < Math.abs(diff)){
                diff = drag.offsetTop - child.offsetTop;
                targetChild = child;
            }
        }
       
        if (targetChild !== beingDragged){
            if (diff < 0){
                answerList.insertBefore(beingDragged, targetChild.nextSibling);                 
            } else {
                answerList.insertBefore(beingDragged, targetChild);   
            }
        }
    };
        
    config.answers.forEach(function(answer, index){
       
       var num = document.createElement('div');
       num.setAttribute('class', 'number');
       num.innerHTML = index + 1;
       
       var txt = document.createElement('div');
       txt.setAttribute('class', 'answer');
       txt.innerHTML = answer;
       
       txt.addEventListener('mousedown', dragstart);
       txt.addEventListener('touchstart', dragstart);
       
       numberList.appendChild(num);
       answerList.appendChild(txt);
    })
    
    document.body.appendChild(clone);
    this.node = document.body.lastElementChild;    
    
    bso.evented(this);
}

bso.slide.title = function(config, sectionType){
        
    var template = document.querySelector('[data-slide=title]');    
    var clone = document.importNode(template.content, true);
    clone.querySelector('.slide-inner').setAttribute('class', 'slide-inner ' + sectionType);        
    clone.querySelector('.title h1').innerHTML = config.title;
    clone.querySelector('.subtitle').innerHTML = config.subtitle;

    document.body.appendChild(clone);
    this.node = document.body.lastElementChild;      
    
    this.complete = true;
}

document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>');  
            bso.start();
        </script>         
    </body>
</html>
